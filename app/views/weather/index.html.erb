<div class="row">
  <div class="col-10 col-md-8 mx-auto">
    <h1>Weather Search</h1>

    <div data-controller="weather-search">
      <!-- ARIA live region for announcing status updates to assistive tech -->
      <div id="weather-status" class="visually-hidden" role="status" aria-live="polite" aria-atomic="true"></div>

      <% current_mode = params[:mode].presence || (
        if @search_info.present?
          @search_info[:type] == :city_state ? 'city_state' : 'zip'
        else
          'zip'
        end) %>

      <%= render partial: 'weather/form', locals: { current_mode: current_mode } %>

      <% if @error.present? %>
        <div class="alert alert-danger mt-3" role="alert"><%= @error %></div>
      <% end %>

      <% if @api_error.present? %>
        <div class="alert alert-warning mt-3" role="alert">
          <strong>API error:</strong>
          <p class="mb-0"><%= h @api_error %></p>
        </div>
      <% end %>

      <%= render partial: 'weather/result', locals: { weather_result: @weather_result, search_info: @search_info, cached: @cached, cached_at: @cached_at } %>
    </div>
  </div>
</div>
