<%= form_with url: '/weather', method: :get, local: true, data: { 'weather-search-target': 'form' }, html: { class: 'needs-validation', novalidate: true } do %>
  <fieldset class="mb-3" role="radiogroup" aria-labelledby="search-by-legend">
    <legend id="search-by-legend" class="col-form-label">Search by</legend>

    <div class="form-check form-check-inline">
      <%= radio_button_tag 'mode', 'zip', current_mode == 'zip', class: 'form-check-input', id: 'mode_zip', data: { action: 'weather-search#modeChange' }, aria: { controls: 'zip-fields', expanded: (current_mode == 'zip') } %>
      <%= label_tag 'mode_zip', 'ZIP code', class: 'form-check-label' %>
    </div>

    <div class="form-check form-check-inline">
      <%= radio_button_tag 'mode', 'city_state', current_mode == 'city_state', class: 'form-check-input', id: 'mode_city_state', data: { action: 'weather-search#modeChange' }, aria: { controls: 'city-state-fields', expanded: (current_mode == 'city_state') } %>
      <%= label_tag 'mode_city_state', 'City / State (US only)', class: 'form-check-label' %>
    </div>
  </fieldset>

  <div id="zip-fields" data-weather-search-target="zipFields" class="mb-3" aria-hidden="<%= current_mode == 'zip' ? 'false' : 'true' %>">
    <%= label_tag :zip, 'ZIP code', class: 'form-label' %>

    <div class="row">
      <div class="col-12 col-md-4">
        <%= text_field_tag :zip, params[:zip], id: 'zip', pattern: '\\d{5}', maxlength: 5, inputmode: 'numeric', placeholder: 'e.g. 90210', class: 'form-control', data: { 'weather-search-target': 'zip' }, aria: { describedby: 'zip-feedback', invalid: 'false' } %>
        <div id="zip-feedback" class="invalid-feedback">Please enter a 5-digit ZIP code.</div>
      </div>
    </div>
  </div>

  <div id="city-state-fields" data-weather-search-target="cityStateFields" class="mb-3 d-none mt-2" aria-hidden="<%= current_mode == 'city_state' ? 'false' : 'true' %>">
    <div class="row g-2">
      <div class="col-12 col-md-8">
        <%= label_tag :city, 'City', class: 'form-label' %>
        <%= text_field_tag :city, params[:city], id: 'city', class: 'form-control', data: { 'weather-search-target': 'city' }, aria: { invalid: 'false' } %>
      </div>

      <div class="col-12 col-md-4 col-lg-3">
        <%= label_tag :state, 'State (2-letter code)', class: 'form-label' %>
        <%= text_field_tag :state, params[:state], id: 'state', maxlength: 2, class: 'form-control text-uppercase', data: { 'weather-search-target': 'state' }, aria: { invalid: 'false' } %>
      </div>
    </div>
  </div>

  <div class="mt-3">
    <%= submit_tag 'Search', class: 'btn btn-primary' %>
  </div>
<% end %>
